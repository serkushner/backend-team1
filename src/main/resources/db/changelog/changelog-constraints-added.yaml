databaseChangeLog:
  - changeSet:
      id: 20210331.[BE-15]-simplify_primary_key
      author: shpaser3@yandex
      comment: "PK changed from 3 columns based to one column based"
      preConditions:
        - onFail: MARK_RAN
      changes:
        - renameColumn:
            columnDataType: bigint
            oldColumnName: id
            newColumnName: oldId
            tableName: additional_info
        - addColumn:
            columns:
              - column:
                  name: id
                  type: bigint
            tableName: additional_info
        - sql:
            sql: |
              update additional_info set id = oldId;
        - dropPrimaryKey:
            tableName: additional_info
        - addNotNullConstraint:
            columnDataType: bigint
            columnName: id
            tableName: additional_info
        - addPrimaryKey:
            columnNames: id
            constraintName: additional_info_PK
            tableName: additional_info
        - dropColumn:
            columnName: oldId
            tableName: additional_info

  - changeSet:
      id: 20210331.[BE-15]-additional_info-unique
      author: shpaser3@yandex
      preConditions:
        - onFail: MARK_RAN
      changes:
        - addUniqueConstraint:
            tableName: additional_info
            columnNames: trainee_id, internship_id
            constraintName: one_email_per_internship

  - changeSet:
      id: 20210331.[BE-15]-resolve_mistake_in_internship_subject
      author: shpaser3@yandex
      preConditions:
        - onFail: MARK_RAN
        - not:
          - columnExists:
              tableName: internship_subject
              columnName: subject_id
      changes:
        - renameColumn:
            tableName:  internship_subject
            columnDataType: bigint
            oldColumnName:  skill_id
            newColumnName:  subject_id

  - changeSet:
      id: 20210331.[BE-15]-renaming_in_internship
      author: shpaser3@yandex
      preConditions:
        - onFail: MARK_RAN
        - not:
          - columnExists:
              tableName: internship
              columnName: name
      changes:
        - renameColumn:
            tableName: internship
            columnDataType: bigint
            oldColumnName: title
            newColumnName: name

  - changeSet:
      id: 20210331.[BE-15]-renaming_in_subject
      author: shpaser3@yandex
      preConditions:
        - onFail: MARK_RAN
        - not:
          - columnExists:
              tableName: subject
              columnName: name
      changes:
        - renameColumn:
            tableName: subject
            columnDataType: bigint
            oldColumnName: title
            newColumnName: name

  - changeSet:
      id: 20210331.[BE-15]-renaming_in_messenger
      author: shpaser3@yandex
      preConditions:
        - onFail: MARK_RAN
        - not:
          - columnExists:
              tableName: messenger
              columnName: name
      changes:
        - renameColumn:
            tableName: messenger
            columnDataType: bigint
            oldColumnName: title
            newColumnName: name

  - changeSet:
      id: 20210331.[BE-15]-renaming_in_trainee_status
      author: shpaser3@yandex
      preConditions:
        - onFail: MARK_RAN
        - not:
            - columnExists:
                tableName: trainee_status
                columnName: name
      changes:
        - renameColumn:
            tableName: trainee_status
            columnDataType: bigint
            oldColumnName: title
            newColumnName: name

  - changeSet:
      id: 20210331.[BE-15]-trainee_fk_admin_set_null_on-delete
      author: shpaser3@yandex
      preConditions:
        - onFail: MARK_RAN
        - not:
            - foreignKeyConstraintExists:
                foreignKeyName: fk_deletion_set_null_administrator
      changes:
        - addForeignKeyConstraint:
            constraintName: fk_deletion_set_null_administrator
            baseTableName: trainee
            baseColumnNames: administrator_id
            onDelete: 'SET NULL'
            referencedTableName: administrator
            referencedColumnNames: id

  - changeSet:
      id: 20210331.[BE-15]-trainee_fk_country_drop_not_null
      author: shpaser3@yandex
      preConditions:
        - onFail: MARK_RAN
      changes:
        - dropNotNullConstraint:
            columnDataType: bigint
            tableName: trainee
            columnName: country_id

  - changeSet:
      id: 20210331.[BE-15]-trainee_fk_status_drop_not_null
      author: shpaser3@yandex
      preConditions:
        - onFail: MARK_RAN
      changes:
        - dropNotNullConstraint:
            columnDataType: bigint
            tableName: trainee
            columnName: status_id

  - changeSet:
      id: 20210331.[BE-15]-trainee_fk_country_set_null_on-delete
      author: shpaser3@yandex
      preConditions:
        - onFail: MARK_RAN
        - not:
            - foreignKeyConstraintExists:
                foreignKeyName: fk_deletion_set_null_trainee_country
      changes:
        - addForeignKeyConstraint:
            constraintName: fk_deletion_set_null_trainee_country
            baseTableName: trainee
            baseColumnNames: country_id
            onDelete: 'SET NULL'
            referencedTableName: country
            referencedColumnNames: id

  - changeSet:
      id: 20210331.[BE-15]-trainee_fk_status_set_null_on-delete
      author: shpaser3@yandex
      preConditions:
        - onFail: MARK_RAN
        - not:
            - foreignKeyConstraintExists:
                foreignKeyName: fk_deletion_set_null_status
      changes:
        - addForeignKeyConstraint:
            constraintName: fk_deletion_set_null_status
            baseTableName: trainee
            baseColumnNames: status_id
            onDelete: 'SET NULL'
            referencedTableName: trainee_status
            referencedColumnNames: id